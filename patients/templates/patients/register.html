<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</title>

  {% load static %}
  <link rel="stylesheet" href="{% static 'css/register_dark.css' %}?v=7">
</head>

<body>
<div class="wrap">

  <!-- ===== TOP BAR ===== -->
  <div class="topbar">
    <div class="pill-title">
      <div class="icon">üßæ</div>
      <div>
        <h1>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</h1>
        <div class="subtitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á Visit / Queue</div>
      </div>
    </div>

    <div class="actions">
      <a class="btn" href="/">üìã ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏¥‡∏ß</a>
      <a class="btn" href="/accounts/dashboard/">üìä Dashboard</a>
    </div>
  </div>

  <!-- ===== CARD ===== -->
  <div class="card">

    {% if form.errors %}
      <div class="alert">‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å</div>
    {% endif %}

    <form method="post" autocomplete="off">
      {% csrf_token %}

      <!-- ================= SECTION 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ================= -->
      <h3 class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</h3>
      <div class="grid">
        <div class="field">
          <label>‡∏ä‡∏∑‡πà‡∏≠</label>
          <input name="first_name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏°‡∏ä‡∏≤‡∏¢"
                 value="{{ form.first_name.value|default:'' }}">
        </div>

        <div class="field">
          <label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
          <input name="last_name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÉ‡∏à‡∏î‡∏µ"
                 value="{{ form.last_name.value|default:'' }}">
        </div>

        <div class="field" style="grid-column: span 2;">
          <label>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
          <input name="national_id" required inputmode="numeric"
                 placeholder="13 ‡∏´‡∏•‡∏±‡∏Å ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Ç‡∏µ‡∏î"
                 value="{{ form.national_id.value|default:'' }}">
          <div class="hint">‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>
        </div>

        <div class="field">
          <label>‡πÄ‡∏û‡∏®</label>
          <select name="gender">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
            <option value="M">‡∏ä‡∏≤‡∏¢</option>
            <option value="F">‡∏´‡∏ç‡∏¥‡∏á</option>
            <option value="O">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
            <option value="UNKNOWN">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</option>
          </select>
        </div>

        <div class="field">
          <label>‡∏≠‡∏≤‡∏¢‡∏∏</label>
          <input name="age" type="number" min="0" placeholder="‡∏õ‡∏µ">
        </div>

        <div class="field">
          <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
          <input name="phone" placeholder="08xxxxxxxx">
        </div>

        
      </div>

      <!-- ================= SECTION 2: ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ================= -->
      <h3 class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h3>
      <div class="grid">
        <div class="field">
          <label>‡∏´‡∏°‡∏π‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏î</label>
          <select name="blood_type">
            <option value="UNKNOWN">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö</option>
            <option>A</option>
            <option>B</option>
            <option>AB</option>
            <option>O</option>
          </select>
        </div>

        <div class="field">
          <label>‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (cm)</label>
          <input name="height_cm" type="number" step="0.01">
        </div>

        <div class="field">
          <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</label>
          <input name="weight_kg" type="number" step="0.01">
        </div>

        <div class="field">
  <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ö‡∏ô (SYS)</label>
  <input name="bp_sys" type="number" min="0" placeholder="‡πÄ‡∏ä‡πà‡∏ô 120">
</div>

<div class="field">
  <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á (DIA)</label>
  <input name="bp_dia" type="number" min="0" placeholder="‡πÄ‡∏ä‡πà‡∏ô 80">
</div>
      </div>

      <div class="field">
        <label>‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
        <textarea name="chronic_diseases" rows="2"></textarea>
      </div>

      <div class="field">
        <label>‡πÅ‡∏û‡πâ‡∏¢‡∏≤ / ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label>
        <textarea name="allergies" rows="2"></textarea>
      </div>

      <div class="field">
        <label>‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡∏à‡∏≥</label>
        <textarea name="medications" rows="2"></textarea>
      </div>

      <!-- ================= SECTION 3: ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ================= -->
<h3 class="section-title">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</h3>

<div class="grid">
  <div class="field">
    <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
    <select id="province" name="province_code" required>
      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î --</option>
    </select>
  </div>

  <div class="field">
    <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</label>
    <select id="district" name="district_code" required disabled>
      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ --</option>
    </select>
  </div>

  <div class="field">
    <label>‡∏ï‡∏≥‡∏ö‡∏•</label>
    <select id="subdistrict" name="subdistrict_code" required disabled>
      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡∏ö‡∏• --</option>
    </select>
  </div>

  <div class="field">
    <label>‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</label>
    <input id="postal_code" name="postal_code" readonly placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡∏ö‡∏•‡∏Å‡πà‡∏≠‡∏ô">
  </div>
</div>

<div class="hint">
  ‚Ä¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏£‡∏ö 3 ‡∏ä‡∏±‡πâ‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á<br>
  ‚Ä¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡πÇ‡∏Ñ‡πâ‡∏î‚Äù (province/district/subdistrict) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥
</div>


      <!-- ================= SECTION 4: ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ================= -->
      <h3 class="section-title">‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</h3>
      <div class="grid">
        <div class="field">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
          <input name="emergency_name">
        </div>

        <div class="field">
          <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
          <input name="emergency_phone">
        </div>
      </div>

      <!-- ================= SECTION 5: ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ ================= -->
      <h3 class="section-title">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h3>
      <div class="field">
        <textarea name="note" rows="2"></textarea>
      </div>

      <!-- ================= FOOTER ================= -->
      <div class="footer">
        <button class="btn primary" type="submit">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</button>
        <a class="btn ghost" href="/">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</a>
      </div>

    </form>
  </div>
</div>

<script>
  // ‡∏•‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£
  const nid = document.querySelector('input[name="national_id"]');
  if (nid) {
    nid.addEventListener("input", () => {
      nid.value = nid.value.replace(/\s+/g, "");
    });
  }

  // ===== Address Dropdown (Thailand full) + Auto PostalCode =====
  fetch("{% static 'data/th_address.json' %}")
    .then(res => res.json())
    .then(list => {
      const provinceSel = document.getElementById("province");
      const districtSel = document.getElementById("district");
      const subdistrictSel = document.getElementById("subdistrict");
      const postalInput = document.getElementById("postal_code");

      if (!provinceSel || !districtSel || !subdistrictSel || !postalInput) {
        console.warn("Address elements not found (province/district/subdistrict/postal_code).");
        return;
      }

      function resetDistrict() {
        districtSel.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ --</option>';
        districtSel.disabled = true;
      }
      function resetSubdistrict() {
        subdistrictSel.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡∏ö‡∏• --</option>';
        subdistrictSel.disabled = true;
      }
      function resetPostal() {
        postalInput.value = "";
      }

      // load provinces
      provinceSel.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î --</option>';
      list.forEach(p => {
        provinceSel.add(new Option(p.provinceNameTh, p.provinceCode));
      });

      provinceSel.addEventListener("change", () => {
        resetDistrict();
        resetSubdistrict();
        resetPostal();

        const p = list.find(x => x.provinceCode === provinceSel.value);
        if (!p) return;

        p.districts.forEach(d => {
          districtSel.add(new Option(d.districtNameTh, d.districtCode));
        });
        districtSel.disabled = false;
      });

      districtSel.addEventListener("change", () => {
        resetSubdistrict();
        resetPostal();

        const p = list.find(x => x.provinceCode === provinceSel.value);
        if (!p) return;

        const d = p.districts.find(x => x.districtCode === districtSel.value);
        if (!d) return;

        d.subdistricts.forEach(s => {
          subdistrictSel.add(new Option(s.subdistrictNameTh, s.subdistrictCode));
        });
        subdistrictSel.disabled = false;
      });

      subdistrictSel.addEventListener("change", () => {
        resetPostal();

        const p = list.find(x => x.provinceCode === provinceSel.value);
        if (!p) return;

        const d = p.districts.find(x => x.districtCode === districtSel.value);
        if (!d) return;

        const s = d.subdistricts.find(x => x.subdistrictCode === subdistrictSel.value);
        if (!s) return;

        postalInput.value = s.postalCode || "";
      });
    })
    .catch(err => {
      console.error("Failed to load th_address.json", err);
    });
</script>


</body>
</html>
